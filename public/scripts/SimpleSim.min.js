/*! SimpleSim v1.0.1 - 2013-09-08 03:09:23 
Vince Allen |Brooklyn, NY | vince@vinceallen.com | @vinceallenvince | License: MIT */
!function(a,b){function c(b){if(!b||!b.world||"object"!=typeof b.world)throw new Error("Item: A valid DOM object is required for a new Item.");this.world=b.world,this.name=b.name||"Item",this.id=this.name+a.System.getNewId(),this.el=document.createElement("div"),this.el.id=this.id,this.el.className="item "+this.name.toLowerCase(),this.el.style.visibility="hidden",this.world.el.appendChild(this.el)}function d(a,b){var c=a||0,d=b||0;this.x=c,this.y=d}function e(b,c){var d=c||{},e=a.Utils.getViewportSize();if(!b||"object"!=typeof b)throw new Error("World: A valid DOM object is required for a new World.");this.el=b,this.el.className="world",this.width=d.width||e.width,this.height=d.height||e.height,this.location=d.location||new a.Vector(e.width/2,e.height/2),this.angle=void 0===d.angle?0:d.angle,this.gravity=d.gravity||new a.Vector(0,.1),this.wind=d.wind||new a.Vector,this.thermal=d.thermal||new a.Vector,this.color=d.color||[230,230,230],this.visibility=d.visibility||"visible",this.cacheVector=new a.Vector,this.pauseStep=!1,this.camera=new a.Vector,this._pool=[]}b.SimpleSim=a;var f={};c.prototype.init=function(b){var c,d=b||{};for(c in d)d.hasOwnProperty(c)&&(this[c]=d[c]);this.acceleration=d.acceleration||new a.Vector,this.velocity=d.velocity||new a.Vector,this.location=d.location||new a.Vector(this.world.width/2,this.world.height/2),this.initLocation=d.initLocation||new a.Vector(this.location.x,this.location.y),this.width=d.width||20,this.height=d.height||20,this.mass=.025*this.width*this.height,this.color=d.color||[0,0,0],this.visibility=d.visibility||"visible",this.maxSpeed=d.maxSpeed||5,this.bounciness=d.bounciness||.75,this.borderRadius=d.borderRadius||0,this.angle=d.angle||0,this.checkWorldEdges=void 0===d.checkWorldEdges?!0:d.checkWorldEdges,this.controlCamera=void 0===d.controlCamera?!1:d.controlCamera},c.prototype.step=function(){this.applyForce(this.world.wind),this.applyForce(this.world.thermal),this.applyForce(this.world.gravity),this.velocity.add(this.acceleration),this.velocity.limit(this.maxSpeed),this.checkWorldEdges&&this._checkWorldEdges(),this.controlCamera&&this._checkCameraEdges(),this.location.add(this.velocity),this.angle=this.location.x,this.acceleration.mult(0)},c.prototype.applyForce=function(a){var b=this.world.cacheVector;b.x=a.x,b.y=a.y,b.div(this.mass),this.acceleration.add(b)},c.prototype._checkWorldEdges=function(){var a=this.world,b=this.location,c=this.velocity,d=this.width,e=this.height,f=this.bounciness;b.x+d/2>a.width?(b.x=a.width-d/2,c.x*=-1*f):b.x<d/2&&(b.x=d/2,c.x*=-1*f),b.y+e/2>a.height?(b.y=a.height-e/2,c.y*=-1*f):b.y<e/2&&(b.y=e/2,c.y*=-1*f)},c.prototype._checkCameraEdges=function(){this.world.camera.x=this.velocity.x,this.world.camera.y=this.velocity.y,this.world.location.add(this.world.camera.mult(-1))},c.prototype.draw=function(){a.System._draw(this)};var g={name:"System"};g._records={lookup:{},list:[]},g._idCount=0,g._stylePosition="",g._resizeTime=0,g.getNewId=function(){return this._idCount++,this._idCount},g.init=function(b,c,d,e){var f=b||function(){},h=d||document.body,i=c||{},j=e||null;this._stylePosition=j.csstransforms3d?"-webkit-transform: translate3d(<x>px, <y>px, 0) rotate(<a>deg); -moz-transform: translate3d(<x>px, <y>px, 0) rotate(<a>deg); -o-transform: translate3d(<x>px, <y>px, 0) rotate(<a>deg); -ms-transform: translate3d(<x>px, <y>px, 0) rotate(<a>deg);":j.csstransforms?"-webkit-transform: translate(<x>px, <y>px) rotate(<a>deg); -moz-transform: translate(<x>px, <y>px) rotate(<a>deg); -o-transform: translate(<x>px, <y>px) rotate(<a>deg); -ms-transform: translate(<x>px, <y>px) rotate(<a>deg);":"position: absolute; left: <x>px; top: <y>px;",g._records.list.push(new a.World(h,i)),a.Utils._addEvent(window,"resize",function(a){g._resize.call(g,a)}),a.Utils._addEvent(window,"devicemotion",function(a){var b=g._records.list[0],c=a.accelerationIncludingGravity.x,d=a.accelerationIncludingGravity.y;0===window.orientation?(b.gravity.x=c,b.gravity.y=-1*d):-90===window.orientation?(b.gravity.x=d,b.gravity.y=c):(b.gravity.x=-1*d,b.gravity.y=-1*c)}),a.Utils._addEvent(window,"keyup",function(a){g._keyup.call(g,a)}),g.mouse={location:new a.Vector,lastLocation:new a.Vector,velocity:new a.Vector},a.Utils._addEvent(document,"mousemove",function(a){g._recordMouseLoc.call(g,a)}),f.call(this),this._setup=f,this._update()},g._keyup=function(a){var b=this._records.list[0];switch(a.keyCode){case 39:g._stepForward();break;case 80:b.pauseStep=!b.pauseStep;break;case 82:g._resetSystem()}},g._recordMouseLoc=function(a){this.mouse.lastLocation.x=this.mouse.location.x,this.mouse.lastLocation.y=this.mouse.location.y,a.pageX&&a.pageY?(this.mouse.location.x=a.pageX,this.mouse.location.y=a.pageY):a.clientX&&a.clientY&&(this.mouse.location.x=a.clientX,this.mouse.location.y=a.clientY),this.mouse.velocity.x=this.mouse.lastLocation.x-this.mouse.location.x,this.mouse.velocity.y=this.mouse.lastLocation.y-this.mouse.location.y},g.add=function(b,c){var d,e,f,g,h=this._records.list,i=this._records.lookup,j=c||{};if(j.world=h[0],f=this.getAllItemsByName(b,j.world._pool),f.length){for(d=0,e=j.world._pool.length;e>d;d++)if(j.world._pool[d].name===b){h[h.length]=j.world._pool.splice(d,1)[0],h[h.length-1].options=j;break}}else if(a[b])h[h.length]=new a[b](j);else{if(!a.Classes[b])throw new Error(b+" class does not exist.");h[h.length]=new a.Classes[b](j)}return g=h.length-1,i[h[g].id]=h[g].el.parentNode,h[g].init(j),h[g]},g.destroyItem=function(a){var b,c,d=this._records.list;for(b=0,c=d.length;c>b;b++)if(d[b].id===a.id){d[b].el.style.opacity=0,d[b].world._pool[d[b].world._pool.length]=d.splice(b,1)[0];break}},g._update=function(){var a,b,c=g._records.list,d=c[0];for(g._resizeTime&&(new Date).getTime()-g._resizeTime>250&&(g._resizeTime=0,d.pauseStep=!1,d.afterResize&&d.afterResize.call(this)),a=c.length-1;a>=0;a-=1)b=c[a],b.world.pauseStep||b.step();for(a=c.length-1;a>=0;a-=1)c[a].draw();window.requestAnimFrame(g._update)},g._stepForward=function(){var a,b=g._records.list,c=this._records.list[0];for(c.pauseStep=!0,a=b.length-1;a>=0;a-=1)b[a].step();for(a=b.length-1;a>=0;a-=1)b[a].draw()},g._draw=function(b){var c=a.System.getCSSText({x:b.location.x-b.width/2,y:b.location.y-b.height/2,width:b.width,height:b.height,color0:b.color[0],color1:b.color[1],color2:b.color[2],opacity:b.opacity,zIndex:b.zIndex,visibility:b.visibility,borderRadius:b.borderRadius,a:b.angle});b.el.style.cssText=c},g.getCSSText=function(a){return this._stylePosition.replace(/<x>/g,a.x).replace(/<y>/g,a.y).replace(/<a>/g,a.a)+" width: "+a.width+"px; height: "+a.height+"px; background-color: "+"rgb("+a.color0+", "+a.color1+", "+a.color2+");"+"opacity: "+a.opacity+"; z-index: "+a.zIndex+"; visibility: "+a.visibility+"; border-radius: "+a.borderRadius+"%"},g._resize=function(){var b,c,d,e=this._records.list,f=a.Utils.getViewportSize(),g=e[0];for(this._resizeTime=(new Date).getTime(),g.pauseStep=!0,b=1,c=e.length;c>b;b++)d=e[b],d.location.x=f.width*(d.location.x/g.width),d.location.y=f.height*(d.location.y/g.height);g.width=f.width,g.height=f.height,g.location=new a.Vector(f.width/2,f.height/2)},g._resetSystem=function(){var b=this._records.list[0],c=a.Utils.getViewportSize();for(b.pauseStep=!1;b.el.firstChild;)b.el.removeChild(b.el.firstChild);b.location=new a.Vector(c.width/2,c.height/2),this._records.list=this._records.list.splice(0,1),g._setup.call(g)},g.getAllItemsByName=function(a,b){var c,d,e=[],f=b||this._records.list;for(c=0,d=f.length;d>c;c++)f[c].name===a&&(e[e.length]=f[c]);return e},g.getAllItemsByAttribute=function(a,b){var c,d,e=[],f=this._records.list,g=void 0!==b?b:null;for(c=0,d=f.length;d>c;c++)if(void 0!==f[c][a]){if(null!==g&&f[c][a]!==g)continue;e[e.length]=f[c]}return e};var h={};h.getViewportSize=function(){var a={};return"undefined"!=typeof window.innerWidth?(a.width=window.innerWidth,a.height=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth?(a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight):"undefined"!=typeof document.body?(a.width=document.body.clientWidth,a.height=document.body.clientHeight):(a.width=void 0,a.height=void 0),a},h._addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},h.extend=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},h.getRandomNumber=function(a,b,c){return c?Math.random()*(b-(a-1))+a:Math.floor(Math.random()*(b-(a-1)))+a},d.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},d.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},d.prototype.mult=function(a){return this.x*=a,this.y*=a,this},d.prototype.div=function(a){return this.x=this.x/a,this.y=this.y/a,this},d.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},d.prototype.limit=function(a,b){var c=a||null,d=b||null;return c&&this.mag()>c&&(this.normalize(),this.mult(c)),d&&this.mag()<d&&(this.normalize(),this.mult(d)),this},d.prototype.normalize=function(){var a=this.mag();return 0!==a?this.div(a):void 0},d.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.x,e=this.y;return this.x=d*b-e*c,this.y=d*c+e*b,this},e.prototype.world={},e.prototype.step=function(){},e.prototype.draw=function(){a.System._draw(this)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),a.Classes=f,a.Item=c,a.System=g,a.Utils=h,a.Vector=d,a.World=e}({},function(){return this}());