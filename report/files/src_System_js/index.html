<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title></title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap-3.0.0-wip.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="brand" href="http://github.com/jsoverson/plato">Plato on Github</a>
    <ul class="nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>src/System.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="span6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"></i></a></h2>
      <p class="stat">63.69</p>
    </div>
    <div class="span6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC"></i></h2>
      <p class="stat">279</p>
    </div>
  </div>
  <div class="row historical">
    <div class="span6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="span6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="span6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty"></i></a></h2>
      <p class="stat">75.78</p>
    </div>
    <div class="span6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs"></i></a></h2>
      <p class="stat">2.77</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="span6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="span6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="span12">/*global exports*/
/** @namespace */
var System = {
  name: &#039;System&#039;
};

/**
 * Stores references to all items in the system.
 * @private
 */
System._records = {
  lookup: {},
  list: []
};

/**
 * Used to create unique ids.
 * @private
 */
System._idCount = 0;

/**
 * Holds a transform property based on supportedFeatures.
 * @private
 */
System._stylePosition = &#039;&#039;;

/**
 * Increments idCount and returns the value.
 */
System.getNewId = function() {
  this._idCount++;
  return this._idCount;
};

/**
 * Initializes the system and starts the update loop.
 *
 * @param {Function} opt_setup= Creates the initial system conditions.
 * @param {Object} opt_world= A reference to a DOM element representing the System world.
 * @param {Function} opt_supportedFeatures= A map of supported browser features.
 */
System.init = function(opt_setup, opt_world, opt_supportedFeatures) {

	var setup = opt_setup || function () {},
      world = opt_world || document.body,
      supportedFeatures = opt_supportedFeatures || null;

  if (supportedFeatures.csstransforms3d) {
    this._stylePosition = &#039;-webkit-transform: translate3d(&lt;x&gt;px, &lt;y&gt;px, 0) rotate(&lt;a&gt;deg); -moz-transform: translate3d(&lt;x&gt;px, &lt;y&gt;px, 0) rotate(&lt;a&gt;deg); -o-transform: translate3d(&lt;x&gt;px, &lt;y&gt;px, 0) rotate(&lt;a&gt;deg); -ms-transform: translate3d(&lt;x&gt;px, &lt;y&gt;px, 0) rotate(&lt;a&gt;deg);&#039;;
  } else if (supportedFeatures.csstransforms) {
    this._stylePosition = &#039;-webkit-transform: translate(&lt;x&gt;px, &lt;y&gt;px) rotate(&lt;a&gt;deg); -moz-transform: translate(&lt;x&gt;px, &lt;y&gt;px) rotate(&lt;a&gt;deg); -o-transform: translate(&lt;x&gt;px, &lt;y&gt;px) rotate(&lt;a&gt;deg); -ms-transform: translate(&lt;x&gt;px, &lt;y&gt;px) rotate(&lt;a&gt;deg);&#039;;
  } else {
    this._stylePosition = &#039;position: absolute; left: &lt;x&gt;px; top: &lt;y&gt;px;&#039;;
  }

  System._records.list.push(new exports.World(world));

  exports.Utils._addEvent(window, &#039;resize&#039;, function(e) {
    System._resize.call(System, e);
  });

  exports.Utils._addEvent(window, &#039;devicemotion&#039;, function(e) {

    var world = System._records.list[0],
        x = e.accelerationIncludingGravity.x,
        y = e.accelerationIncludingGravity.y;

    if (window.orientation === 0) {
      world.gravity.x = x;
      world.gravity.y = y * -1;
    } else if (window.orientation === -90) {
      world.gravity.x = y;
      world.gravity.y = x;
    } else {
      world.gravity.x = y * -1;
      world.gravity.y = x * -1;
    }
  });

  exports.Utils._addEvent(window, &#039;keyup&#039;, function(e) {
    System._keyup.call(System, e);
  });

  System.mouse = {
    location: new exports.Vector(),
    lastLocation: new exports.Vector(),
    velocity: new exports.Vector()
  };
  exports.Utils._addEvent(document, &#039;mousemove&#039;, function(e) {
    System._recordMouseLoc.call(System, e);
  });

	setup.call(this);
  this._setup = setup;
  this._update();


};

/**
 * Handles keyup events.
 *
 * @param {Object} e An event.
 */
System._keyup = function(e) {

  var world = this._records.list[0];

  switch(e.keyCode) {
    case 39:
      System._stepForward(); // right arrow: step forward
    break;
    case 80: // p; pause/play
      world.pauseStep = !world.pauseStep;
      break;
    case 82: // r; reset
      System._resetSystem();
      break;
  }
};

/**
 * Saves the mouse velocity and location relative to the browser viewport.
 * @param {Object} e An event.
 * @private
 */
System._recordMouseLoc = function(e) {
  this.mouse.lastLocation.x = this.mouse.location.x;
  this.mouse.lastLocation.y = this.mouse.location.y;
  if (e.pageX &amp;&amp; e.pageY) {
    this.mouse.location.x = e.pageX;
    this.mouse.location.y = e.pageY;
  } else if (e.clientX &amp;&amp; e.clientY) {
    this.mouse.location.x = e.clientX;
    this.mouse.location.y = e.clientY;
  }
  this.mouse.velocity.x = this.mouse.lastLocation.x - this.mouse.location.x;
  this.mouse.velocity.y = this.mouse.lastLocation.y - this.mouse.location.y;
};

/**
 * Adds an object to the system.
 *
 * @param {Object} opt_options= Object properties.
 */
System.add = function(klass, opt_options) {

  var last, records = this._records.list,
      recordsLookup = this._records.lookup,
      options = opt_options || {};

  options.world = records[0];

  if (exports[klass]) {
    records[records.length] = new exports[klass](options);
  } else if (exports.Classes[klass]) {
    records[records.length] = new exports.Classes[klass](options);
  } else {
    throw new Error(klass + &#039; class does not exist.&#039;);
  }

  last = records.length - 1;
  recordsLookup[records[last].id] = records[last].el.parentNode;
  records[last].init(options);
  return records[last];
};

/**
 * Iterates over objects in the system and calls step() and draw().
 * @private
 */
System._update = function() {

  var i, records = System._records.list, record;

  for (i = records.length - 1; i &gt;= 0; i -= 1) {
    record = records[i];
    if (!record.world.pauseStep) {
      record.step();
    }
  }

  for (i = records.length - 1; i &gt;= 0; i -= 1) {
    records[i].draw();
  }
  window.requestAnimFrame(System._update);
};

/**
 * Pauses the system and processes one step in records.
 * @private
 */
System._stepForward = function() {

  var i, records = System._records.list,
      world = this._records.list[0];

  world.pauseStep = true;

  for (i = records.length - 1; i &gt;= 0; i -= 1) {
    records[i].step();
  }
  for (i = records.length - 1; i &gt;= 0; i -= 1) {
    records[i].draw();
  }
};

/**
 * Updates the corresponding DOM element&#039;s style property.
 */
System._draw = function(obj) {

  var cssText = exports.System.getCSSText({
    x: obj.location.x - (obj.width / 2),
    y: obj.location.y - (obj.height / 2),
    width: obj.width,
    height: obj.height,
    color0: obj.color[0],
    color1: obj.color[1],
    color2: obj.color[2],
    visibility: obj.visibility,
    borderRadius: obj.borderRadius,
    a: obj.angle
  });
  obj.el.style.cssText = cssText;
};

/**
 * Concatenates a new cssText string.
 *
 * @param {Object} props A map of object properties.
 */
System.getCSSText = function(props) {
  return this._stylePosition.replace(/&lt;x&gt;/g, props.x).replace(/&lt;y&gt;/g, props.y).replace(/&lt;a&gt;/g, props.a) + &#039; width: &#039; +
      props.width + &#039;px; height: &#039; + props.height + &#039;px; background-color: &#039; +
      &#039;rgb(&#039; + props.color0 + &#039;, &#039; + props.color1 + &#039;, &#039; + props.color2 + &#039;);&#039; +
      &#039;visibility: &#039; + props.visibility + &#039;; border-radius: &#039; + props.borderRadius + &#039;%&#039;;
};

/**
 * Repositions all items relative to the viewport size and resets the world bounds.
 */
System._resize = function() {

  var i, max, records = this._records.list, record,
      viewportSize = exports.Utils.getViewportSize(),
      world = records[0];

  for (i = 1, max = records.length; i &lt; max; i++) {
    record = records[i];
    record.location.x = viewportSize.width * (record.location.x / world.width);
    record.location.y = viewportSize.height * (record.location.y / world.height);
  }

  world.width = viewportSize.width;
  world.height = viewportSize.height;
  world.location = new exports.Vector((viewportSize.width / 2),
    (viewportSize.height / 2));
};

/**
 * Resets the system.
 *
 * @param {boolean} opt_noRestart= Pass true to not restart the system.
 * @private
 */
System._resetSystem = function(opt_noRestart) {

  var world = this._records.list[0],
      viewportSize = exports.Utils.getViewportSize();

  world.pauseStep = false;
  while(world.el.firstChild) {
    world.el.removeChild(world.el.firstChild);
  }
  world.location = new exports.Vector((viewportSize.width / 2),
    (viewportSize.height / 2));
  this._records.list = this._records.list.splice(0, 1);
  System._setup.call(System);
};</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
